// ============================================================
// Google Apps Script — Kadion Phillips Campaign Form → Google Sheets
// ============================================================
//
// SETUP INSTRUCTIONS (takes ~5 minutes):
//
// 1. Go to https://script.google.com and click "New Project"
//
// 2. Delete everything in the editor and paste this ENTIRE file
//
// 3. At the top of the script below, replace the SPREADSHEET_ID
//    with your Google Sheet ID (the long string in the sheet URL):
//    https://docs.google.com/spreadsheets/d/THIS_IS_YOUR_ID/edit
//
// 4. Create a Google Sheet with TWO tabs (sheets):
//    - Tab 1: Named "Contacts" with these headers in Row 1:
//      Timestamp | Name | Email | Phone | Subject | Message | Updates
//
//    - Tab 2: Named "Donations" with these headers in Row 1:
//      Timestamp | Full Name | Email | Phone | Address | City | State | ZIP | Amount | Date | Occupation | Employer
//
// 5. Click "Deploy" → "New deployment"
//    - Type: "Web app"
//    - Execute as: "Me"
//    - Who has access: "Anyone"
//    - Click "Deploy"
//    - Authorize when prompted (click through the "unsafe" warning — it's your own script)
//    - COPY the Web App URL it gives you
//
// 6. Paste that URL into your index.html where it says:
   var GOOGLE_SHEET_URL = 'https://script.google.com/macros/s/AKfycbxqldtmBLUHaViwf94AqzAFPIFubFUCOScJssJijMLR36Lr7ijpOzQLEn4SbOz_13psOw/exec';
//
// 7. Test by submitting both forms on your site — data should appear in the sheet!
//
// NOTE: If you update this script later, you must create a NEW deployment
// (Deploy → New deployment) for changes to take effect.
// ============================================================

var SPREADSHEET_ID = 'YOUR_SPREADSHEET_ID_HERE';

function doPost(e) {
  try {
    var data = JSON.parse(e.postData.contents);
    var ss = SpreadsheetApp.openById(SPREADSHEET_ID);
    var formType = data.form_type || 'Unknown';
    var timestamp = data.submitted_at || new Date().toISOString();

    if (formType === 'Contact') {
      var sheet = ss.getSheetByName('Contacts');
      if (!sheet) {
        sheet = ss.insertSheet('Contacts');
        sheet.appendRow(['Timestamp', 'Name', 'Email', 'Phone', 'Subject', 'Message', 'Updates']);
      }
      sheet.appendRow([
        timestamp,
        data.name || '',
        data.email || '',
        data.phone || '',
        data.subject || '',
        data.message || '',
        data.updates || 'no'
      ]);
    }

    else if (formType === 'Donation') {
      var sheet = ss.getSheetByName('Donations');
      if (!sheet) {
        sheet = ss.insertSheet('Donations');
        sheet.appendRow(['Timestamp', 'Full Name', 'Email', 'Phone', 'Address', 'City', 'State', 'ZIP', 'Amount', 'Date', 'Occupation', 'Employer']);
      }
      sheet.appendRow([
        timestamp,
        data.donor_name || '',
        data.donor_email || '',
        data.donor_phone || '',
        data.donor_address || '',
        data.donor_city || '',
        data.donor_state || '',
        data.donor_zip || '',
        data.donation_amount || '',
        data.donation_date || '',
        data.occupation || '',
        data.employer || ''
      ]);
    }

    return ContentService
      .createTextOutput(JSON.stringify({ status: 'success' }))
      .setMimeType(ContentService.MimeType.JSON);

  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({ status: 'error', message: error.toString() }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Optional: handle GET requests for testing
function doGet(e) {
  return ContentService
    .createTextOutput('Campaign form handler is running.')
    .setMimeType(ContentService.MimeType.TEXT);
}
